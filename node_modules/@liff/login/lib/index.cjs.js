"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@liff/consts"),i=require("@liff/logger"),r=require("@liff/util"),o=require("@liff/store"),t=require("@liff/server-api"),n=require("@liff/get-version"),f=require("@liff/is-sub-window"),l=require("@liff/is-in-client"),s=require("@liff/hooks"),u=require("@liff/sub-window"),a=require("tiny-sha256");var d=function(){function d(){this.hooks={before:new s.SyncHook}}return Object.defineProperty(d.prototype,"name",{get:function(){return"login"},enumerable:!1,configurable:!0}),d.prototype.install=function(){return this.login.bind(this)},d.prototype.login=function(s){var d;this.hooks.before.call(s);var c,g=r.randomAlphaNumericString(43),p=(c=g,r.hexToBase64(a(c)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")),h=o.getConfig();if(!h||!h.liffId)throw r.createLiffError(e.INVALID_CONFIG,"You need to define `liffId` for liff.login()");var _={app_id:h.liffId,state:r.randomAlphaNumericString(12),response_type:"code",code_challenge_method:"S256",code_challenge:p,liff_sdk_version:n.getVersion()};s&&s.redirectUri&&(_.redirect_uri=s.redirectUri),f.isSubWindow()&&!l.isInClient()&&((null===(d=u.getMessageBus())||void 0===d?void 0:d.isReady())?_.redirect_uri=window.location.href:_.disable_auto_login="true"),o.setLoginTmp({codeVerifier:g});var b=t.getEndPoint("authorize")+"?"+r.qs.stringify(_);i.logger.debug("[Redirect] ".concat(b)),window.location.href=b},d}();exports.LoginModule=d;
