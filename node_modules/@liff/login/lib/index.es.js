import{INVALID_CONFIG as i}from"@liff/consts";import{logger as r}from"@liff/logger";import{hexToBase64 as o,randomAlphaNumericString as e,createLiffError as t,qs as f}from"@liff/util";import{getConfig as n,setLoginTmp as l}from"@liff/store";import{getEndPoint as c}from"@liff/server-api";import{getVersion as d}from"@liff/get-version";import{isSubWindow as a}from"@liff/is-sub-window";import{isInClient as p}from"@liff/is-in-client";import{SyncHook as s}from"@liff/hooks";import{getMessageBus as m}from"@liff/sub-window";var u=require("tiny-sha256");var g=function(){function g(){this.hooks={before:new s}}return Object.defineProperty(g.prototype,"name",{get:function(){return"login"},enumerable:!1,configurable:!0}),g.prototype.install=function(){return this.login.bind(this)},g.prototype.login=function(s){var g;this.hooks.before.call(s);var h=e(43),_=o(u(h)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,""),v=n();if(!v||!v.liffId)throw t(i,"You need to define `liffId` for liff.login()");var b={app_id:v.liffId,state:e(12),response_type:"code",code_challenge_method:"S256",code_challenge:_,liff_sdk_version:d()};s&&s.redirectUri&&(b.redirect_uri=s.redirectUri),a()&&!p()&&((null===(g=m())||void 0===g?void 0:g.isReady())?b.redirect_uri=window.location.href:b.disable_auto_login="true"),l({codeVerifier:h});var w=c("authorize")+"?"+f.stringify(b);r.debug("[Redirect] ".concat(w)),window.location.href=w},g}();export{g as LoginModule};
